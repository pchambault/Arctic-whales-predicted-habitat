---
title: "Current predictions from AWI-CMIP6 (6 variables)"
author: "Philippine Chambault"
date: "02/28/2022"
output: 
  bookdown::html_document2:
    number_sections: yes
    code_folding: show
    df_print: default
    fig_caption: yes
    toc: yes
    toc_float:
      collapsed: yes
      smooth_scroll: no
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(
  echo      = TRUE,
  fig.align = "center",
  message = FALSE,
  warning = FALSE,
  cache   = FALSE,
  out.width = "100%",
  comment = NA
)
```
```{r global_options, include=FALSE}
library(viridis)
library(raster)
library(maps)
library(gridExtra)
library(tidyquant)
library(tidyverse)
library(dplyr)
library(RColorBrewer)
library(ggmap)
library(dplyr)
library(ncdf4)
library(fields)
library(rgeos)
```


# Context 

Considering the review from Science Advances received in February 20222, I explored the Global Climate Models from IPCC CMIP6, despite coarser spatial resolution that could not match the coastal behaviour of Arctic whales. 

Three GCM at a 25 km resolution were found ("AWI-CM-1-1-MR","HadGEM3-GC31-MM","CNRM-CM6"), including _Sea Surface Temperature_ (tos), _Sea Surface Salinity_ (sos), _Sea Surface Height_ (zos) and _Mixed Layer Depth_ (mlotst). These 4 dynamic variables were first (i) extracted from CMIP6 for the historical period (1993-2014) and contemporary period (2015-2020) from ssp126. Then, each variable was included in the initial models run on the available dataset (current predictions: "present").

The results here are presented for summer only.





# Model performance {.tabset}
Three new dynamic variables were added to each model (SSS, MLD and SSH), which improved the performance of the algorithms on the tracking data ("present distribution").

```{r, echo=F}
perf <- readRDS("/Users/philippinechambault/Documents/POST-DOC/2021/PAPER3/RDATA/5.CARET/Performance/PerfMOD_Summer_6algo_6var_3sp_AWI-CM-1-1-MR_.rds") 
perf = perf %>%
  dplyr::select(-c(precision,recall,preval))

pivot = perf %>%
  pivot_longer(!c(model,species,side,run), 
               names_to = "metric", values_to = "value")  
```

## Bowheads
```{r, echo=F}
best = pivot %>%
  filter(species=="Bw") %>%
  mutate(type = case_when(
  side == "West" & model == "gbm" ~ "Highlighted",
  side == "East" & model == "earth" ~ "Highlighted"))
```

```{r, echo=FALSE, fig.pos="placeHere", fig.height=4.5,fig.cap="\\label{fig:figs}Boxplot of the performance metrics for bowheads in summer (AWI-CM-1-1-MR)."}
ggplot(best, aes(x=model, y=value,colour=type)) +
  geom_boxplot(outlier.shape = NA, lwd=0.2, fatten=0.2) +
  labs(y="", x="", title = "Performance metrics in Summer",
       subtitle="Bowheads (model: AWI-CM-1-1-MR)") +
  facet_grid(side~metric) +
  scale_colour_manual(values=c("red", "black")) +
  ylim(0,1) +
  geom_hline(yintercept = 0.5, lwd=0.2, lty=2) +
  theme_tq() +
  theme(legend.position = "none") +
  theme(axis.title.y = element_text(size=7,color="black"),
        axis.title.x = element_text(size=7,color="black"),
        axis.text.x  = element_text(size=7,angle=90,vjust=0.5,hjust=0.5,color="black"),
        axis.text.y  = element_text(size=7,color="black"))
```

## Narwhals
```{r, echo=F}
best = pivot %>%
  filter(species=="Nar") %>%
  mutate(type = case_when(
  side == "West" & model == "gbm" ~ "Highlighted",
  side == "East" & model == "gbm" ~ "Highlighted"))
```

```{r, echo=FALSE, fig.pos="placeHere", fig.height=4.5,fig.cap="\\label{fig:figs}Boxplot of the performance metrics for narwhals in summer (AWI-CM-1-1-MR)."}
ggplot(best, aes(x=model, y=value, colour=type)) +
  geom_boxplot(outlier.shape = NA, lwd=0.2, fatten=0.2) +
  labs(y="", x="", title = "Performance metrics in Summer",
       subtitle="Narwhals (model: AWI-CM-1-1-MR)") +
  facet_grid(side~metric) +
  ylim(0.5,1) +
  scale_colour_manual(values=c("red", "black")) +
  geom_hline(yintercept = 0.5, lwd=0.2, lty=2) +
  theme_tq() +
  theme(legend.position = "none") +
  theme(axis.title.y = element_text(size=7,color="black"),
        axis.title.x = element_text(size=7,color="black"),
        axis.text.x  = element_text(size=7,angle=90,vjust=0.5,hjust=0.5,color="black"),
        axis.text.y  = element_text(size=7,color="black"))
```

## Belugas
```{r, echo=F}
best = pivot %>%
  filter(species=="Bel") %>%
  mutate(type = case_when(model == "gbm" ~ "Highlighted"))
```

```{r, echo=FALSE, fig.pos="placeHere", fig.height=3,fig.cap="\\label{fig:figs}Boxplot of the performance metrics for belugas in summer (model: AWI-CM-1-1-MR)."}
ggplot(best, aes(x=model, y=value, colour=type)) +
  geom_boxplot(outlier.shape = NA, lwd=0.2, fatten=0.2) +
  labs(y="", x="", title = "Performance metrics in Summer",
       subtitle="Belugas (model: AWI-CM-1-1-MR)") +
  facet_grid(.~metric) +
  ylim(0.5,1) +
  scale_colour_manual(values=c("red", "black")) +
  geom_hline(yintercept = 0.5, lwd=0.2, lty=2) +
  theme_tq() +
  theme(legend.position = "none") +
  theme(axis.title.y = element_text(size=7,color="black"),
        axis.title.x = element_text(size=7,color="black"),
        axis.text.x  = element_text(size=7,angle=90,vjust=0.5,hjust=0.5,color="black"),
        axis.text.y  = element_text(size=7,color="black"))
```

The _Random Forest_ suffers from overfitting, so the best algorithm for each species is: GBM for belugas, narwhals East and bowheads West, BRT for narwhals West and MARS for bowheads East.







# Variable importance

```{r, echo=F}
imp <- readRDS("/Users/philippinechambault/Documents/POST-DOC/2021/PAPER3/RDATA/5.CARET/VarImp/VarImp_3sp_Summer_0.25deg_6var_AWI-CM-1-1-MR.rds")
```
```{r, echo=FALSE, fig.pos="placeHere", fig.height=5,fig.cap="\\label{fig:figs}Boxplot of the performance metrics for belugas in summer."}
ggplot(imp, aes(x=var, y=imp, fill=sp)) +
  geom_boxplot(outlier.shape = NA, lwd=0.3, fatten=0.6) +
  coord_flip() +
  scale_fill_brewer(palette = "Set3") +
  labs(y="Value", x="", title = "Variable importance",
       subtitle = "Summer (best algo)") +
  facet_grid(sp~side) +
  theme_tq() +
  theme(legend.position = "none")
```

Most important variables are:

- _distance to coast_ for belugas and narwhals West;

- _SSH_ for narwhals East;

- _SSS_ for bowheads West;

- _SST_ for bowheads East.










# Predictions Belugas {.tabset}

```{r, echo=F}
north_map = map_data("world") %>% group_by(group)
shore     = north_map[north_map$region=="Canada" 
                      | north_map$region=="Greenland"
                      | north_map$region=="Norway"
                      | north_map$region=="Russia"
                      | north_map$region=="Sweden"
                      | north_map$region=="Denmark"
                      | north_map$region=="Finland"
                      | north_map$region=="Iceland",]

```

## BRT
```{r, echo=F}
m <- readRDS("/Users/philippinechambault/Documents/POST-DOC/2021/PAPER3/RDATA/5.CARET/Bel_West/Predictions/Summer/AWI-CM-1-1-MR/Average_6var/PredMean_Summer_6var_AWI-CM-1-1-MR_Bel_West_blackboost.rds")
m <- as_tibble(rasterToPoints(m))
```

```{r, echo=FALSE, fig.pos="placeHere", fig.height=4,fig.cap="\\label{fig:figs}mean prediction maps for Belugas in summer (present) from the BRT."}
ggplot(shore, aes(long, lat)) +
  geom_tile(data=m, aes(x,y, fill=layer)) +
  scale_fill_distiller(palette="BuPu", direction=1, 
                       limits=c(0,1), breaks=seq(0,1,by=0.2)) +
  coord_map("azequidistant", xlim=c(-105,-40), ylim=c(60,80)) +
  scale_y_continuous(breaks=c(60,70), labels=c(60,70)) +
  geom_polygon(aes(group=group), fill="lightgrey",lwd=1) +
  labs(y="",x="",fill="Habitat \nsuitability",title="Belugas",
       subtitle="Summer, BRT") + 
  theme(axis.text.y  = element_blank(),
        axis.text.x  = element_blank(),
        axis.ticks   = element_blank(),
        strip.background = element_rect(fill="gray52", size=0.1),
        strip.text = element_text(colour='black',size=12,face="bold",
                                  margin=margin(0.1,0.1,0.1,0.1,"cm")),
        axis.title = element_text(size=12,face="bold", hjust=0.5),
        panel.border = element_rect(colour="black",fill=NA,size=0.2),
        legend.key.size = unit(0.5,"line"),
        legend.key.width = unit(0.14,"cm"),
        legend.key.height = unit(0.3,"cm"),
        legend.title = element_text(size=7),
        legend.text = element_text(size=7),
        legend.box.spacing = unit(0.1,'cm'),
        legend.margin=margin(t=-0.0, unit='cm'),
        legend.key = element_blank(),
        panel.spacing.x = unit(0.07, "lines"),
        panel.spacing.y = unit(0.07, "lines"),
        title = element_text(colour="black",size=14,face="bold"),
        plot.title=element_text(size=14, vjust=-0.5, hjust=0),
        panel.background = element_blank(),
        panel.grid.major = element_line(colour="gray52", size=0.1),
        plot.margin = unit(c(0,0.1,-1,-0.4),"cm")) 
```


## MARS
```{r, echo=F}
m <- readRDS("/Users/philippinechambault/Documents/POST-DOC/2021/PAPER3/RDATA/5.CARET/Bel_West/Predictions/Summer/AWI-CM-1-1-MR/Average_6var/PredMean_Summer_6var_AWI-CM-1-1-MR_Bel_West_earth.rds")
m <- as_tibble(rasterToPoints(m))
```

```{r, echo=FALSE, fig.pos="placeHere", fig.height=4,fig.cap="\\label{fig:figs}Mean prediction maps for belugas in summer from the MARS."}
ggplot(shore, aes(long, lat)) +
  geom_tile(data=m, aes(x,y, fill=layer)) +
  scale_fill_distiller(palette="BuPu", direction=1, 
                       limits=c(0,1), breaks=seq(0,1,by=0.2)) +
  coord_map("azequidistant", xlim=c(-105,-40), ylim=c(60,80)) +
  scale_y_continuous(breaks=c(60,70), labels=c(60,70)) +
  geom_polygon(aes(group=group), fill="lightgrey",lwd=1) +
  labs(y="",x="",fill="Habitat \nsuitability",title="Belugas",
       subtitle="Summer, MARS") + 
  theme(axis.text.y  = element_blank(),
        axis.text.x  = element_blank(),
        axis.ticks   = element_blank(),
        strip.background = element_rect(fill="gray52", size=0.1),
        strip.text = element_text(colour='black',size=12,face="bold",
                                  margin=margin(0.1,0.1,0.1,0.1,"cm")),
        axis.title = element_text(size=12,face="bold", hjust=0.5),
        panel.border = element_rect(colour="black",fill=NA,size=0.2),
        legend.key.size = unit(0.5,"line"),
        legend.key.width = unit(0.14,"cm"),
        legend.key.height = unit(0.3,"cm"),
        legend.title = element_text(size=7),
        legend.text = element_text(size=7),
        legend.box.spacing = unit(0.1,'cm'),
        legend.margin=margin(t=-0.0, unit='cm'),
        legend.key = element_blank(),
        panel.spacing.x = unit(0.07, "lines"),
        panel.spacing.y = unit(0.07, "lines"),
        title = element_text(colour="black",size=14,face="bold"),
        plot.title=element_text(size=14, vjust=-0.5, hjust=0),
        panel.background = element_blank(),
        panel.grid.major = element_line(colour="gray52", size=0.1),
        plot.margin = unit(c(0,0.1,-1,-0.4),"cm")) 
```


## GBM
```{r, echo=F}
m <- readRDS("/Users/philippinechambault/Documents/POST-DOC/2021/PAPER3/RDATA/5.CARET/Bel_West/Predictions/Summer/AWI-CM-1-1-MR/Average_6var/PredMean_Summer_6var_AWI-CM-1-1-MR_Bel_West_gbm.rds")
m <- as_tibble(rasterToPoints(m))
```

```{r, echo=FALSE, fig.pos="placeHere", fig.height=4,fig.cap="\\label{fig:figs}Mean prediction maps for belugas in summer from the GBM."}
ggplot(shore, aes(long, lat)) +
  geom_tile(data=m, aes(x,y, fill=layer)) +
  scale_fill_distiller(palette="BuPu", direction=1, 
                       limits=c(0,1), breaks=seq(0,1,by=0.2)) +
  coord_map("azequidistant", xlim=c(-105,-40), ylim=c(60,80)) +
  scale_y_continuous(breaks=c(60,70), labels=c(60,70)) +
  geom_polygon(aes(group=group), fill="lightgrey",lwd=1) +
  labs(y="",x="",fill="Habitat \nsuitability",title="Belugas",
       subtitle="Summer, Mean GBM") + 
  theme(axis.text.y  = element_blank(),
        axis.text.x  = element_blank(),
        axis.ticks   = element_blank(),
        strip.background = element_rect(fill="gray52", size=0.1),
        strip.text = element_text(colour='black',size=12,face="bold",
                                  margin=margin(0.1,0.1,0.1,0.1,"cm")),
        axis.title = element_text(size=12,face="bold", hjust=0.5),
        panel.border = element_rect(colour="black",fill=NA,size=0.2),
        legend.key.size = unit(0.5,"line"),
        legend.key.width = unit(0.14,"cm"),
        legend.key.height = unit(0.3,"cm"),
        legend.title = element_text(size=7),
        legend.text = element_text(size=7),
        legend.box.spacing = unit(0.1,'cm'),
        legend.margin=margin(t=-0.0, unit='cm'),
        legend.key = element_blank(),
        panel.spacing.x = unit(0.07, "lines"),
        panel.spacing.y = unit(0.07, "lines"),
        title = element_text(colour="black",size=14,face="bold"),
        plot.title=element_text(size=14, vjust=-0.5, hjust=0),
        panel.background = element_blank(),
        panel.grid.major = element_line(colour="gray52", size=0.1),
        plot.margin = unit(c(0,0.1,-1,-0.4),"cm")) 
```


## Max GBM
```{r, echo=F}
m <- readRDS("/Users/philippinechambault/Documents/POST-DOC/2021/PAPER3/RDATA/5.CARET/Bel_West/Predictions/Summer/AWI-CM-1-1-MR/Average_6var/PredMax_Summer_6var_AWI-CM-1-1-MR_Bel_West_gbm.rds")
m <- as_tibble(rasterToPoints(m))
```

```{r, echo=FALSE, fig.pos="placeHere", fig.height=4,fig.cap="\\label{fig:figs}Max prediction maps for belugas in summer from the GBM."}
ggplot(shore, aes(long, lat)) +
  geom_contour_filled(data=m, aes(x,y,z=layer), breaks=seq(0,1,by=0.2)) +
  scale_fill_brewer(palette="BuPu") + 
  # geom_tile(data=m, aes(x,y, fill=layer)) +
  # scale_fill_distiller(palette="BuPu", direction=1, 
  #                      limits=c(0,1), breaks=seq(0,1,by=0.2)) +
  coord_map("azequidistant", xlim=c(-105,-40), ylim=c(60,80)) +
  scale_y_continuous(breaks=c(60,70), labels=c(60,70)) +
  geom_polygon(aes(group=group), fill="lightgrey",lwd=1) +
  labs(y="",x="",fill="Habitat \nsuitability",title="Belugas",
       subtitle="Summer, Max GBM") + 
  theme(axis.text.y  = element_blank(),
        axis.text.x  = element_blank(),
        axis.ticks   = element_blank(),
        strip.background = element_rect(fill="gray52", size=0.1),
        strip.text = element_text(colour='black',size=12,face="bold",
                                  margin=margin(0.1,0.1,0.1,0.1,"cm")),
        axis.title = element_text(size=12,face="bold", hjust=0.5),
        panel.border = element_rect(colour="black",fill=NA,size=0.2),
        legend.key.size = unit(0.5,"line"),
        legend.key.width = unit(0.14,"cm"),
        legend.key.height = unit(0.3,"cm"),
        legend.title = element_text(size=7),
        legend.text = element_text(size=7),
        legend.box.spacing = unit(0.1,'cm'),
        legend.margin=margin(t=-0.0, unit='cm'),
        legend.key = element_blank(),
        panel.spacing.x = unit(0.07, "lines"),
        panel.spacing.y = unit(0.07, "lines"),
        title = element_text(colour="black",size=14,face="bold"),
        plot.title=element_text(size=14, vjust=-0.5, hjust=0),
        panel.background = element_blank(),
        panel.grid.major = element_line(colour="gray52", size=0.1),
        plot.margin = unit(c(0,0.1,-1,-0.4),"cm")) 
```


## GAM
```{r, echo=F}
m <- readRDS("/Users/philippinechambault/Documents/POST-DOC/2021/PAPER3/RDATA/5.CARET/Bel_West/Predictions/Summer/AWI-CM-1-1-MR/Average_6var/PredMean_Summer_6var_AWI-CM-1-1-MR_Bel_West_gamboost.rds")
m <- as_tibble(rasterToPoints(m))
```

```{r, echo=FALSE, fig.pos="placeHere", fig.height=4,fig.cap="\\label{fig:figs}Mean prediction maps for belugas in summer from the GAM."}
ggplot(shore, aes(long, lat)) +
  geom_tile(data=m, aes(x,y, fill=layer)) +
  scale_fill_distiller(palette="BuPu", direction=1, 
                       limits=c(0,1), breaks=seq(0,1,by=0.2)) +
  coord_map("azequidistant", xlim=c(-105,-40), ylim=c(60,80)) +
  scale_y_continuous(breaks=c(60,70), labels=c(60,70)) +
  geom_polygon(aes(group=group), fill="lightgrey",lwd=1) +
  labs(y="",x="",fill="Habitat \nsuitability",title="Belugas",
       subtitle="Summer, GAM") + 
  theme(axis.text.y  = element_blank(),
        axis.text.x  = element_blank(),
        axis.ticks   = element_blank(),
        strip.background = element_rect(fill="gray52", size=0.1),
        strip.text = element_text(colour='black',size=12,face="bold",
                                  margin=margin(0.1,0.1,0.1,0.1,"cm")),
        axis.title = element_text(size=12,face="bold", hjust=0.5),
        panel.border = element_rect(colour="black",fill=NA,size=0.2),
        legend.key.size = unit(0.5,"line"),
        legend.key.width = unit(0.14,"cm"),
        legend.key.height = unit(0.3,"cm"),
        legend.title = element_text(size=7),
        legend.text = element_text(size=7),
        legend.box.spacing = unit(0.1,'cm'),
        legend.margin=margin(t=-0.0, unit='cm'),
        legend.key = element_blank(),
        panel.spacing.x = unit(0.07, "lines"),
        panel.spacing.y = unit(0.07, "lines"),
        title = element_text(colour="black",size=14,face="bold"),
        plot.title=element_text(size=14, vjust=-0.5, hjust=0),
        panel.background = element_blank(),
        panel.grid.major = element_line(colour="gray52", size=0.1),
        plot.margin = unit(c(0,0.1,-1,-0.4),"cm")) 
```


## GLM
```{r, echo=F}
m <- readRDS("/Users/philippinechambault/Documents/POST-DOC/2021/PAPER3/RDATA/5.CARET/Bel_West/Predictions/Summer/AWI-CM-1-1-MR/Average_6var/PredMean_Summer_6var_AWI-CM-1-1-MR_Bel_West_glmboost.rds")
m <- as_tibble(rasterToPoints(m))
```

```{r, echo=FALSE, fig.pos="placeHere", fig.height=4,fig.cap="\\label{fig:figs}Mean prediction maps for belugas in summer from the GLM."}
ggplot(shore, aes(long, lat)) +
  geom_tile(data=m, aes(x,y, fill=layer)) +
  scale_fill_distiller(palette="BuPu", direction=1, 
                       limits=c(0,1), breaks=seq(0,1,by=0.2)) +
  coord_map("azequidistant", xlim=c(-105,-40), ylim=c(60,80)) +
  scale_y_continuous(breaks=c(60,70), labels=c(60,70)) +
  geom_polygon(aes(group=group), fill="lightgrey",lwd=1) +
  labs(y="",x="",fill="Habitat \nsuitability",title="Belugas",
       subtitle="Summer, GLM") + 
  theme(axis.text.y  = element_blank(),
        axis.text.x  = element_blank(),
        axis.ticks   = element_blank(),
        strip.background = element_rect(fill="gray52", size=0.1),
        strip.text = element_text(colour='black',size=12,face="bold",
                                  margin=margin(0.1,0.1,0.1,0.1,"cm")),
        axis.title = element_text(size=12,face="bold", hjust=0.5),
        panel.border = element_rect(colour="black",fill=NA,size=0.2),
        legend.key.size = unit(0.5,"line"),
        legend.key.width = unit(0.14,"cm"),
        legend.key.height = unit(0.3,"cm"),
        legend.title = element_text(size=7),
        legend.text = element_text(size=7),
        legend.box.spacing = unit(0.1,'cm'),
        legend.margin=margin(t=-0.0, unit='cm'),
        legend.key = element_blank(),
        panel.spacing.x = unit(0.07, "lines"),
        panel.spacing.y = unit(0.07, "lines"),
        title = element_text(colour="black",size=14,face="bold"),
        plot.title=element_text(size=14, vjust=-0.5, hjust=0),
        panel.background = element_blank(),
        panel.grid.major = element_line(colour="gray52", size=0.1),
        plot.margin = unit(c(0,0.1,-1,-0.4),"cm")) 
```


## RF
```{r, echo=F}
m <- readRDS("/Users/philippinechambault/Documents/POST-DOC/2021/PAPER3/RDATA/5.CARET/Bel_West/Predictions/Summer/AWI-CM-1-1-MR/Average_6var/PredMean_Summer_6var_AWI-CM-1-1-MR_Bel_West_rf.rds")
m <- as_tibble(rasterToPoints(m))
```

```{r, echo=FALSE, fig.pos="placeHere", fig.height=4,fig.cap="\\label{fig:figs}Mean prediction maps for belugas in summer from the RF."}
ggplot(shore, aes(long, lat)) +
  geom_tile(data=m, aes(x,y, fill=layer)) +
  scale_fill_distiller(palette="BuPu", direction=1, 
                       limits=c(0,1), breaks=seq(0,1,by=0.2)) +
  coord_map("azequidistant", xlim=c(-105,-40), ylim=c(60,80)) +
  scale_y_continuous(breaks=c(60,70), labels=c(60,70)) +
  geom_polygon(aes(group=group), fill="lightgrey",lwd=1) +
  labs(y="",x="",fill="Habitat \nsuitability",title="Belugas",
       subtitle="Summer, Mean RF") + 
  theme(axis.text.y  = element_blank(),
        axis.text.x  = element_blank(),
        axis.ticks   = element_blank(),
        strip.background = element_rect(fill="gray52", size=0.1),
        strip.text = element_text(colour='black',size=12,face="bold",
                                  margin=margin(0.1,0.1,0.1,0.1,"cm")),
        axis.title = element_text(size=12,face="bold", hjust=0.5),
        panel.border = element_rect(colour="black",fill=NA,size=0.2),
        legend.key.size = unit(0.5,"line"),
        legend.key.width = unit(0.14,"cm"),
        legend.key.height = unit(0.3,"cm"),
        legend.title = element_text(size=7),
        legend.text = element_text(size=7),
        legend.box.spacing = unit(0.1,'cm'),
        legend.margin=margin(t=-0.0, unit='cm'),
        legend.key = element_blank(),
        panel.spacing.x = unit(0.07, "lines"),
        panel.spacing.y = unit(0.07, "lines"),
        title = element_text(colour="black",size=14,face="bold"),
        plot.title=element_text(size=14, vjust=-0.5, hjust=0),
        panel.background = element_blank(),
        panel.grid.major = element_line(colour="gray52", size=0.1),
        plot.margin = unit(c(0,0.1,-1,-0.4),"cm")) 
```


## Max RF
```{r, echo=F}
m <- readRDS("/Users/philippinechambault/Documents/POST-DOC/2021/PAPER3/RDATA/5.CARET/Bel_West/Predictions/Summer/AWI-CM-1-1-MR/Average_6var/PredMax_Summer_6var_AWI-CM-1-1-MR_Bel_West_rf.rds")
m <- as_tibble(rasterToPoints(m))
```

```{r, echo=FALSE, fig.pos="placeHere", fig.height=4,fig.cap="\\label{fig:figs}Max prediction maps for belugas in summer from the RF."}
ggplot(shore, aes(long, lat)) +
  geom_tile(data=m, aes(x,y, fill=layer)) +
  scale_fill_distiller(palette="BuPu", direction=1,
                       limits=c(0,1), breaks=seq(0,1,by=0.2)) +
  # geom_contour_filled(data=m, aes(x,y,z=layer), breaks=seq(0,1,by=0.1)) +
  # scale_fill_brewer(palette="BuPu") + 
  coord_map("azequidistant", xlim=c(-105,-40), ylim=c(60,80)) +
  scale_y_continuous(breaks=c(60,70), labels=c(60,70)) +
  geom_polygon(aes(group=group), fill="lightgrey",lwd=1) +
  labs(y="",x="",fill="Habitat \nsuitability",title="Belugas",
       subtitle="Summer, Max RF") + 
  theme(axis.text.y  = element_blank(),
        axis.text.x  = element_blank(),
        axis.ticks   = element_blank(),
        strip.background = element_rect(fill="gray52", size=0.1),
        strip.text = element_text(colour='black',size=12,face="bold",
                                  margin=margin(0.1,0.1,0.1,0.1,"cm")),
        axis.title = element_text(size=12,face="bold", hjust=0.5),
        panel.border = element_rect(colour="black",fill=NA,size=0.2),
        legend.key.size = unit(0.5,"line"),
        legend.key.width = unit(0.14,"cm"),
        legend.key.height = unit(0.3,"cm"),
        legend.title = element_text(size=7),
        legend.text = element_text(size=7),
        legend.box.spacing = unit(0.1,'cm'),
        legend.margin=margin(t=-0.0, unit='cm'),
        legend.key = element_blank(),
        panel.spacing.x = unit(0.07, "lines"),
        panel.spacing.y = unit(0.07, "lines"),
        title = element_text(colour="black",size=14,face="bold"),
        plot.title=element_text(size=14, vjust=-0.5, hjust=0),
        panel.background = element_blank(),
        panel.grid.major = element_line(colour="gray52", size=0.1),
        plot.margin = unit(c(0,0.1,-1,-0.4),"cm")) 
```















# Predictions Narwhals {.tabset}

## BRT
```{r, echo=F}
west <- readRDS("/Users/philippinechambault/Documents/POST-DOC/2021/PAPER3/RDATA/5.CARET/Nar_West/Predictions/Summer/AWI-CM-1-1-MR/Average_6var/PredMean_Summer_6var_AWI-CM-1-1-MR_Nar_West_blackboost.rds")
west <- as_tibble(rasterToPoints(west))

east <- readRDS("/Users/philippinechambault/Documents/POST-DOC/2021/PAPER3/RDATA/5.CARET/Nar_East/Predictions/Summer/AWI-CM-1-1-MR/Average_6var/PredMean_Summer_6var_AWI-CM-1-1-MR_Nar_East_blackboost.rds")
east <- as_tibble(rasterToPoints(east))
```

```{r, echo=FALSE, fig.pos="placeHere", fig.height=4,fig.cap="\\label{fig:figs}Mean prediction maps for Narwhals in summer (present) from the BRT."}
ggplot(shore, aes(long, lat)) +
  geom_tile(data=west, aes(x,y, fill=layer)) +
  geom_tile(data=east, aes(x,y, fill=layer)) +
  scale_fill_distiller(palette="BuPu", direction=1, 
                       limits=c(0,1), breaks=seq(0,1,by=0.2)) +
  coord_map("azequidistant", xlim=c(-105,0), ylim=c(60,80)) +
  scale_y_continuous(breaks=c(60,70), labels=c(60,70)) +
  geom_polygon(aes(group=group), fill="lightgrey",lwd=1) +
  labs(y="",x="",fill="Habitat \nsuitability",title="Narwhals",
       subtitle="Summer, BRT") + 
  theme(axis.text.y  = element_blank(),
        axis.text.x  = element_blank(),
        axis.ticks   = element_blank(),
        strip.background = element_rect(fill="gray52", size=0.1),
        strip.text = element_text(colour='black',size=12,face="bold",
                                  margin=margin(0.1,0.1,0.1,0.1,"cm")),
        axis.title = element_text(size=12,face="bold", hjust=0.5),
        panel.border = element_rect(colour="black",fill=NA,size=0.2),
        legend.key.size = unit(0.5,"line"),
        legend.key.width = unit(0.14,"cm"),
        legend.key.height = unit(0.3,"cm"),
        legend.title = element_text(size=7),
        legend.text = element_text(size=7),
        legend.box.spacing = unit(0.1,'cm'),
        legend.margin=margin(t=-0.0, unit='cm'),
        legend.key = element_blank(),
        panel.spacing.x = unit(0.07, "lines"),
        panel.spacing.y = unit(0.07, "lines"),
        title = element_text(colour="black",size=14,face="bold"),
        plot.title=element_text(size=14, vjust=-0.5, hjust=0),
        panel.background = element_blank(),
        panel.grid.major = element_line(colour="gray52", size=0.1),
        plot.margin = unit(c(0,0.1,-1,-0.4),"cm")) 
```


## MARS
```{r, echo=F}
west <- readRDS("/Users/philippinechambault/Documents/POST-DOC/2021/PAPER3/RDATA/5.CARET/Nar_West/Predictions/Summer/AWI-CM-1-1-MR/Average_6var/PredMean_Summer_6var_AWI-CM-1-1-MR_Nar_West_earth.rds")
west <- as_tibble(rasterToPoints(west))

east <- readRDS("/Users/philippinechambault/Documents/POST-DOC/2021/PAPER3/RDATA/5.CARET/Nar_East/Predictions/Summer/AWI-CM-1-1-MR/Average_6var/PredMean_Summer_6var_AWI-CM-1-1-MR_Nar_East_earth.rds")
east <- as_tibble(rasterToPoints(east))
```

```{r, echo=FALSE, fig.pos="placeHere", fig.height=4,fig.cap="\\label{fig:figs}Mean prediction maps for Narwhals in summer from the MARS."}
ggplot(shore, aes(long, lat)) +
  geom_tile(data=west, aes(x,y, fill=layer)) +
  geom_tile(data=east, aes(x,y, fill=layer)) +
  scale_fill_distiller(palette="BuPu", direction=1, 
                       limits=c(0,1), breaks=seq(0,1,by=0.2)) +
  coord_map("azequidistant", xlim=c(-105,0), ylim=c(60,80)) +
  scale_y_continuous(breaks=c(60,70), labels=c(60,70)) +
  geom_polygon(aes(group=group), fill="lightgrey",lwd=1) +
  labs(y="",x="",fill="Habitat \nsuitability",title="Narwhals",
       subtitle="Summer, MARS") + 
  theme(axis.text.y  = element_blank(),
        axis.text.x  = element_blank(),
        axis.ticks   = element_blank(),
        strip.background = element_rect(fill="gray52", size=0.1),
        strip.text = element_text(colour='black',size=12,face="bold",
                                  margin=margin(0.1,0.1,0.1,0.1,"cm")),
        axis.title = element_text(size=12,face="bold", hjust=0.5),
        panel.border = element_rect(colour="black",fill=NA,size=0.2),
        legend.key.size = unit(0.5,"line"),
        legend.key.width = unit(0.14,"cm"),
        legend.key.height = unit(0.3,"cm"),
        legend.title = element_text(size=7),
        legend.text = element_text(size=7),
        legend.box.spacing = unit(0.1,'cm'),
        legend.margin=margin(t=-0.0, unit='cm'),
        legend.key = element_blank(),
        panel.spacing.x = unit(0.07, "lines"),
        panel.spacing.y = unit(0.07, "lines"),
        title = element_text(colour="black",size=14,face="bold"),
        plot.title=element_text(size=14, vjust=-0.5, hjust=0),
        panel.background = element_blank(),
        panel.grid.major = element_line(colour="gray52", size=0.1),
        plot.margin = unit(c(0,0.1,-1,-0.4),"cm")) 
```


## GBM
```{r, echo=F}
west <- readRDS("/Users/philippinechambault/Documents/POST-DOC/2021/PAPER3/RDATA/5.CARET/Nar_West/Predictions/Summer/AWI-CM-1-1-MR/Average_6var/PredMean_Summer_6var_AWI-CM-1-1-MR_Nar_West_gbm.rds")
west <- as_tibble(rasterToPoints(west))

east <- readRDS("/Users/philippinechambault/Documents/POST-DOC/2021/PAPER3/RDATA/5.CARET/Nar_East/Predictions/Summer/AWI-CM-1-1-MR/Average_6var/PredMean_Summer_6var_AWI-CM-1-1-MR_Nar_East_gbm.rds")
east <- as_tibble(rasterToPoints(east))
```

```{r, echo=FALSE, fig.pos="placeHere", fig.height=4,fig.cap="\\label{fig:figs}Mean prediction maps for Narwhals in summer from the GBM."}
ggplot(shore, aes(long, lat)) +
  geom_tile(data=west, aes(x,y, fill=layer)) +
  geom_tile(data=east, aes(x,y, fill=layer)) +
  scale_fill_distiller(palette="BuPu", direction=1, 
                       limits=c(0,1), breaks=seq(0,1,by=0.2)) +
  coord_map("azequidistant", xlim=c(-105,0), ylim=c(60,80)) +
  scale_y_continuous(breaks=c(60,70), labels=c(60,70)) +
  geom_polygon(aes(group=group), fill="lightgrey",lwd=1) +
  labs(y="",x="",fill="Habitat \nsuitability",title="Narwhals",
       subtitle="Summer, GBM") + 
  theme(axis.text.y  = element_blank(),
        axis.text.x  = element_blank(),
        axis.ticks   = element_blank(),
        strip.background = element_rect(fill="gray52", size=0.1),
        strip.text = element_text(colour='black',size=12,face="bold",
                                  margin=margin(0.1,0.1,0.1,0.1,"cm")),
        axis.title = element_text(size=12,face="bold", hjust=0.5),
        panel.border = element_rect(colour="black",fill=NA,size=0.2),
        legend.key.size = unit(0.5,"line"),
        legend.key.width = unit(0.14,"cm"),
        legend.key.height = unit(0.3,"cm"),
        legend.title = element_text(size=7),
        legend.text = element_text(size=7),
        legend.box.spacing = unit(0.1,'cm'),
        legend.margin=margin(t=-0.0, unit='cm'),
        legend.key = element_blank(),
        panel.spacing.x = unit(0.07, "lines"),
        panel.spacing.y = unit(0.07, "lines"),
        title = element_text(colour="black",size=14,face="bold"),
        plot.title=element_text(size=14, vjust=-0.5, hjust=0),
        panel.background = element_blank(),
        panel.grid.major = element_line(colour="gray52", size=0.1),
        plot.margin = unit(c(0,0.1,-1,-0.4),"cm")) 
```


## GAM
```{r, echo=F}
west <- readRDS("/Users/philippinechambault/Documents/POST-DOC/2021/PAPER3/RDATA/5.CARET/Nar_West/Predictions/Summer/AWI-CM-1-1-MR/Average_6var/PredMean_Summer_6var_AWI-CM-1-1-MR_Nar_West_gamboost.rds")
west <- as_tibble(rasterToPoints(west))

east <- readRDS("/Users/philippinechambault/Documents/POST-DOC/2021/PAPER3/RDATA/5.CARET/Nar_East/Predictions/Summer/AWI-CM-1-1-MR/Average_6var/PredMean_Summer_6var_AWI-CM-1-1-MR_Nar_East_gamboost.rds")
east <- as_tibble(rasterToPoints(east))
```

```{r, echo=FALSE, fig.pos="placeHere", fig.height=4,fig.cap="\\label{fig:figs}Mean prediction maps for Narwhals in summer from the GAM."}
ggplot(shore, aes(long, lat)) +
  geom_tile(data=west, aes(x,y, fill=layer)) +
  geom_tile(data=east, aes(x,y, fill=layer)) +
  scale_fill_distiller(palette="BuPu", direction=1, 
                       limits=c(0,1), breaks=seq(0,1,by=0.2)) +
  coord_map("azequidistant", xlim=c(-105,0), ylim=c(60,80)) +
  scale_y_continuous(breaks=c(60,70), labels=c(60,70)) +
  geom_polygon(aes(group=group), fill="lightgrey",lwd=1) +
  labs(y="",x="",fill="Habitat \nsuitability",title="Narwhals",
       subtitle="Summer, GAM") + 
  theme(axis.text.y  = element_blank(),
        axis.text.x  = element_blank(),
        axis.ticks   = element_blank(),
        strip.background = element_rect(fill="gray52", size=0.1),
        strip.text = element_text(colour='black',size=12,face="bold",
                                  margin=margin(0.1,0.1,0.1,0.1,"cm")),
        axis.title = element_text(size=12,face="bold", hjust=0.5),
        panel.border = element_rect(colour="black",fill=NA,size=0.2),
        legend.key.size = unit(0.5,"line"),
        legend.key.width = unit(0.14,"cm"),
        legend.key.height = unit(0.3,"cm"),
        legend.title = element_text(size=7),
        legend.text = element_text(size=7),
        legend.box.spacing = unit(0.1,'cm'),
        legend.margin=margin(t=-0.0, unit='cm'),
        legend.key = element_blank(),
        panel.spacing.x = unit(0.07, "lines"),
        panel.spacing.y = unit(0.07, "lines"),
        title = element_text(colour="black",size=14,face="bold"),
        plot.title=element_text(size=14, vjust=-0.5, hjust=0),
        panel.background = element_blank(),
        panel.grid.major = element_line(colour="gray52", size=0.1),
        plot.margin = unit(c(0,0.1,-1,-0.4),"cm")) 
```


## GLM
```{r, echo=F}
west <- readRDS("/Users/philippinechambault/Documents/POST-DOC/2021/PAPER3/RDATA/5.CARET/Nar_West/Predictions/Summer/AWI-CM-1-1-MR/Average_6var/PredMean_Summer_6var_AWI-CM-1-1-MR_Nar_West_glmboost.rds")
west <- as_tibble(rasterToPoints(west))

east <- readRDS("/Users/philippinechambault/Documents/POST-DOC/2021/PAPER3/RDATA/5.CARET/Nar_East/Predictions/Summer/AWI-CM-1-1-MR/Average_6var/PredMean_Summer_6var_AWI-CM-1-1-MR_Nar_East_glmboost.rds")
east <- as_tibble(rasterToPoints(east))
```

```{r, echo=FALSE, fig.pos="placeHere", fig.height=4,fig.cap="\\label{fig:figs}Mean prediction maps for Narwhals in summer from the GLM."}
ggplot(shore, aes(long, lat)) +
  geom_tile(data=west, aes(x,y, fill=layer)) +
  geom_tile(data=east, aes(x,y, fill=layer)) +
  scale_fill_distiller(palette="BuPu", direction=1, 
                       limits=c(0,1), breaks=seq(0,1,by=0.2)) +
  coord_map("azequidistant", xlim=c(-105,0), ylim=c(60,80)) +
  scale_y_continuous(breaks=c(60,70), labels=c(60,70)) +
  geom_polygon(aes(group=group), fill="lightgrey",lwd=1) +
  labs(y="",x="",fill="Habitat \nsuitability",title="Narwhals",
       subtitle="Summer, GLM") + 
  theme(axis.text.y  = element_blank(),
        axis.text.x  = element_blank(),
        axis.ticks   = element_blank(),
        strip.background = element_rect(fill="gray52", size=0.1),
        strip.text = element_text(colour='black',size=12,face="bold",
                                  margin=margin(0.1,0.1,0.1,0.1,"cm")),
        axis.title = element_text(size=12,face="bold", hjust=0.5),
        panel.border = element_rect(colour="black",fill=NA,size=0.2),
        legend.key.size = unit(0.5,"line"),
        legend.key.width = unit(0.14,"cm"),
        legend.key.height = unit(0.3,"cm"),
        legend.title = element_text(size=7),
        legend.text = element_text(size=7),
        legend.box.spacing = unit(0.1,'cm'),
        legend.margin=margin(t=-0.0, unit='cm'),
        legend.key = element_blank(),
        panel.spacing.x = unit(0.07, "lines"),
        panel.spacing.y = unit(0.07, "lines"),
        title = element_text(colour="black",size=14,face="bold"),
        plot.title=element_text(size=14, vjust=-0.5, hjust=0),
        panel.background = element_blank(),
        panel.grid.major = element_line(colour="gray52", size=0.1),
        plot.margin = unit(c(0,0.1,-1,-0.4),"cm")) 
```


## RF
```{r, echo=F}
west <- readRDS("/Users/philippinechambault/Documents/POST-DOC/2021/PAPER3/RDATA/5.CARET/Nar_West/Predictions/Summer/AWI-CM-1-1-MR/Average_6var/PredMean_Summer_6var_AWI-CM-1-1-MR_Nar_West_rf.rds")
west <- as_tibble(rasterToPoints(west))

east <- readRDS("/Users/philippinechambault/Documents/POST-DOC/2021/PAPER3/RDATA/5.CARET/Nar_East/Predictions/Summer/AWI-CM-1-1-MR/Average_6var/PredMean_Summer_6var_AWI-CM-1-1-MR_Nar_East_rf.rds")
east <- as_tibble(rasterToPoints(east))
```

```{r, echo=FALSE, fig.pos="placeHere", fig.height=4,fig.cap="\\label{fig:figs}Mean prediction maps for Narwhals in summer from the RF."}
ggplot(shore, aes(long, lat)) +
  geom_tile(data=west, aes(x,y, fill=layer)) +
  geom_tile(data=east, aes(x,y, fill=layer)) +
  scale_fill_distiller(palette="BuPu", direction=1, 
                       limits=c(0,1), breaks=seq(0,1,by=0.2)) +
  coord_map("azequidistant", xlim=c(-105,0), ylim=c(60,80)) +
  scale_y_continuous(breaks=c(60,70), labels=c(60,70)) +
  geom_polygon(aes(group=group), fill="lightgrey",lwd=1) +
  labs(y="",x="",fill="Habitat \nsuitability",title="Narwhals",
       subtitle="Summer, Mean RF") + 
  theme(axis.text.y  = element_blank(),
        axis.text.x  = element_blank(),
        axis.ticks   = element_blank(),
        strip.background = element_rect(fill="gray52", size=0.1),
        strip.text = element_text(colour='black',size=12,face="bold",
                                  margin=margin(0.1,0.1,0.1,0.1,"cm")),
        axis.title = element_text(size=12,face="bold", hjust=0.5),
        panel.border = element_rect(colour="black",fill=NA,size=0.2),
        legend.key.size = unit(0.5,"line"),
        legend.key.width = unit(0.14,"cm"),
        legend.key.height = unit(0.3,"cm"),
        legend.title = element_text(size=7),
        legend.text = element_text(size=7),
        legend.box.spacing = unit(0.1,'cm'),
        legend.margin=margin(t=-0.0, unit='cm'),
        legend.key = element_blank(),
        panel.spacing.x = unit(0.07, "lines"),
        panel.spacing.y = unit(0.07, "lines"),
        title = element_text(colour="black",size=14,face="bold"),
        plot.title=element_text(size=14, vjust=-0.5, hjust=0),
        panel.background = element_blank(),
        panel.grid.major = element_line(colour="gray52", size=0.1),
        plot.margin = unit(c(0,0.1,-1,-0.4),"cm")) 
```




## Max GBM
```{r, echo=F}
west <- readRDS("/Users/philippinechambault/Documents/POST-DOC/2021/PAPER3/RDATA/5.CARET/Nar_West/Predictions/Summer/AWI-CM-1-1-MR/Average_6var/PredMax_Summer_6var_AWI-CM-1-1-MR_Nar_West_gbm.rds")
west <- as_tibble(rasterToPoints(west))

east <- readRDS("/Users/philippinechambault/Documents/POST-DOC/2021/PAPER3/RDATA/5.CARET/Nar_East/Predictions/Summer/AWI-CM-1-1-MR/Average_6var/PredMax_Summer_6var_AWI-CM-1-1-MR_Nar_East_gbm.rds")
east <- as_tibble(rasterToPoints(east))
```

```{r, echo=FALSE, fig.pos="placeHere", fig.height=4,fig.cap="\\label{fig:figs}Max prediction maps for Narwhals in summer from the BRt West and GBM East."}
ggplot(shore, aes(long, lat)) +
  geom_contour_filled(data=west, aes(x,y,z=layer), breaks=seq(0,1,by=0.2)) +
  geom_contour_filled(data=east, aes(x,y,z=layer), breaks=seq(0,1,by=0.2)) +
  scale_fill_brewer(palette="BuPu") + 
  coord_map("azequidistant", xlim=c(-105,0), ylim=c(60,80)) +
  scale_y_continuous(breaks=c(60,70), labels=c(60,70)) +
  geom_polygon(aes(group=group), fill="lightgrey",lwd=1) +
  labs(y="",x="",fill="Habitat \nsuitability",title="Narwhals",
       subtitle="Summer, max GBM") + 
  theme(axis.text.y  = element_blank(),
        axis.text.x  = element_blank(),
        axis.ticks   = element_blank(),
        strip.background = element_rect(fill="gray52", size=0.1),
        strip.text = element_text(colour='black',size=12,face="bold",
                                  margin=margin(0.1,0.1,0.1,0.1,"cm")),
        axis.title = element_text(size=12,face="bold", hjust=0.5),
        panel.border = element_rect(colour="black",fill=NA,size=0.2),
        # legend.position = "none",
        panel.spacing.x = unit(0.07, "lines"),
        panel.spacing.y = unit(0.07, "lines"),
        title = element_text(colour="black",size=14,face="bold"),
        plot.title=element_text(size=14, vjust=-0.5, hjust=0),
        panel.background = element_blank(),
        panel.grid.major = element_line(colour="gray52", size=0.1),
        plot.margin = unit(c(0,0.1,-1,-0.4),"cm")) 
```


















# Predictions Bowheads {.tabset}

## BRT
```{r, echo=F}
west <- readRDS("/Users/philippinechambault/Documents/POST-DOC/2021/PAPER3/RDATA/5.CARET/Bw_West/Predictions/Summer/AWI-CM-1-1-MR/Average_6var/PredMean_Summer_6var_AWI-CM-1-1-MR_Bw_West_blackboost.rds")
west <- as_tibble(rasterToPoints(west))

east <- readRDS("/Users/philippinechambault/Documents/POST-DOC/2021/PAPER3/RDATA/5.CARET/Bw_East/Predictions/Summer/AWI-CM-1-1-MR/Average_6var/PredMean_Summer_6var_AWI-CM-1-1-MR_Bw_East_blackboost.rds")
east <- as_tibble(rasterToPoints(east))
```

```{r, echo=FALSE, fig.pos="placeHere", fig.height=4,fig.cap="\\label{fig:figs}Mean prediction maps for Bowheads in summer (present) from the BRT."}
ggplot(shore, aes(long, lat)) +
  geom_tile(data=west, aes(x,y, fill=layer)) +
  geom_tile(data=east, aes(x,y, fill=layer)) +
  scale_fill_distiller(palette="BuPu", direction=1, 
                       limits=c(0,1), breaks=seq(0,1,by=0.2)) +
  coord_map("azequidistant", xlim=c(-105,80), ylim=c(60,80)) +
  scale_y_continuous(breaks=c(60,70), labels=c(60,70)) +
  geom_polygon(aes(group=group), fill="lightgrey",lwd=1) +
  labs(y="",x="",fill="Habitat \nsuitability",title="Bowheads",
       subtitle="Summer, BRT") + 
  theme(axis.text.y  = element_blank(),
        axis.text.x  = element_blank(),
        axis.ticks   = element_blank(),
        strip.background = element_rect(fill="gray52", size=0.1),
        strip.text = element_text(colour='black',size=12,face="bold",
                                  margin=margin(0.1,0.1,0.1,0.1,"cm")),
        axis.title = element_text(size=12,face="bold", hjust=0.5),
        panel.border = element_rect(colour="black",fill=NA,size=0.2),
        legend.key.size = unit(0.5,"line"),
        legend.key.width = unit(0.14,"cm"),
        legend.key.height = unit(0.3,"cm"),
        legend.title = element_text(size=7),
        legend.text = element_text(size=7),
        legend.box.spacing = unit(0.1,'cm'),
        legend.margin=margin(t=-0.0, unit='cm'),
        legend.key = element_blank(),
        panel.spacing.x = unit(0.07, "lines"),
        panel.spacing.y = unit(0.07, "lines"),
        title = element_text(colour="black",size=14,face="bold"),
        plot.title=element_text(size=14, vjust=-0.5, hjust=0),
        panel.background = element_blank(),
        panel.grid.major = element_line(colour="gray52", size=0.1),
        plot.margin = unit(c(0,0.1,-1,-0.4),"cm")) 
```



## MARS
```{r, echo=F}
west <- readRDS("/Users/philippinechambault/Documents/POST-DOC/2021/PAPER3/RDATA/5.CARET/Bw_West/Predictions/Summer/AWI-CM-1-1-MR/Average_6var/PredMean_Summer_6var_AWI-CM-1-1-MR_Bw_West_earth.rds")
west <- as_tibble(rasterToPoints(west))

east <- readRDS("/Users/philippinechambault/Documents/POST-DOC/2021/PAPER3/RDATA/5.CARET/Bw_East/Predictions/Summer/AWI-CM-1-1-MR/Average_6var/PredMean_Summer_6var_AWI-CM-1-1-MR_Bw_East_earth.rds")
east <- as_tibble(rasterToPoints(east))
```

```{r, echo=FALSE, fig.pos="placeHere", fig.height=4,fig.cap="\\label{fig:figs}Mean prediction maps for Bowheads in summer from the MARS."}
ggplot(shore, aes(long, lat)) +
  geom_tile(data=west, aes(x,y, fill=layer)) +
  geom_tile(data=east, aes(x,y, fill=layer)) +
  scale_fill_distiller(palette="BuPu", direction=1, 
                       limits=c(0,1), breaks=seq(0,1,by=0.2)) +
  coord_map("azequidistant", xlim=c(-105,80), ylim=c(60,80)) +
  scale_y_continuous(breaks=c(60,70), labels=c(60,70)) +
  geom_polygon(aes(group=group), fill="lightgrey",lwd=1) +
  labs(y="",x="",fill="Habitat \nsuitability",title="Bowheads",
       subtitle="Summer, MARS") + 
  theme(axis.text.y  = element_blank(),
        axis.text.x  = element_blank(),
        axis.ticks   = element_blank(),
        strip.background = element_rect(fill="gray52", size=0.1),
        strip.text = element_text(colour='black',size=12,face="bold",
                                  margin=margin(0.1,0.1,0.1,0.1,"cm")),
        axis.title = element_text(size=12,face="bold", hjust=0.5),
        panel.border = element_rect(colour="black",fill=NA,size=0.2),
        legend.key.size = unit(0.5,"line"),
        legend.key.width = unit(0.14,"cm"),
        legend.key.height = unit(0.3,"cm"),
        legend.title = element_text(size=7),
        legend.text = element_text(size=7),
        legend.box.spacing = unit(0.1,'cm'),
        legend.margin=margin(t=-0.0, unit='cm'),
        legend.key = element_blank(),
        panel.spacing.x = unit(0.07, "lines"),
        panel.spacing.y = unit(0.07, "lines"),
        title = element_text(colour="black",size=14,face="bold"),
        plot.title=element_text(size=14, vjust=-0.5, hjust=0),
        panel.background = element_blank(),
        panel.grid.major = element_line(colour="gray52", size=0.1),
        plot.margin = unit(c(0,0.1,-1,-0.4),"cm")) 
```


## Max MARS
```{r, echo=F}
west <- readRDS("/Users/philippinechambault/Documents/POST-DOC/2021/PAPER3/RDATA/5.CARET/Bw_West/Predictions/Summer/AWI-CM-1-1-MR/Average_6var/PredMax_Summer_6var_AWI-CM-1-1-MR_Bw_West_earth.rds")
west <- as_tibble(rasterToPoints(west))

east <- readRDS("/Users/philippinechambault/Documents/POST-DOC/2021/PAPER3/RDATA/5.CARET/Bw_East/Predictions/Summer/AWI-CM-1-1-MR/Average_6var/PredMax_Summer_6var_AWI-CM-1-1-MR_Bw_East_earth.rds")
east <- as_tibble(rasterToPoints(east))
```

```{r, echo=FALSE, fig.pos="placeHere", fig.height=4,fig.cap="\\label{fig:figs}Max prediction maps for Bowheads in summer from the MARS."}
ggplot(shore, aes(long, lat)) +
  geom_tile(data=west, aes(x,y, fill=layer)) +
  geom_tile(data=east, aes(x,y, fill=layer)) +
  scale_fill_distiller(palette="BuPu", direction=1, 
                       limits=c(0,1), breaks=seq(0,1,by=0.2)) +
  coord_map("azequidistant", xlim=c(-105,80), ylim=c(60,80)) +
  scale_y_continuous(breaks=c(60,70), labels=c(60,70)) +
  geom_polygon(aes(group=group), fill="lightgrey",lwd=1) +
  labs(y="",x="",fill="Habitat \nsuitability",title="Bowheads",
       subtitle="Summer, Max MARS") + 
  theme(axis.text.y  = element_blank(),
        axis.text.x  = element_blank(),
        axis.ticks   = element_blank(),
        strip.background = element_rect(fill="gray52", size=0.1),
        strip.text = element_text(colour='black',size=12,face="bold",
                                  margin=margin(0.1,0.1,0.1,0.1,"cm")),
        axis.title = element_text(size=12,face="bold", hjust=0.5),
        panel.border = element_rect(colour="black",fill=NA,size=0.2),
        legend.key.size = unit(0.5,"line"),
        legend.key.width = unit(0.14,"cm"),
        legend.key.height = unit(0.3,"cm"),
        legend.title = element_text(size=7),
        legend.text = element_text(size=7),
        legend.box.spacing = unit(0.1,'cm'),
        legend.margin=margin(t=-0.0, unit='cm'),
        legend.key = element_blank(),
        panel.spacing.x = unit(0.07, "lines"),
        panel.spacing.y = unit(0.07, "lines"),
        title = element_text(colour="black",size=14,face="bold"),
        plot.title=element_text(size=14, vjust=-0.5, hjust=0),
        panel.background = element_blank(),
        panel.grid.major = element_line(colour="gray52", size=0.1),
        plot.margin = unit(c(0,0.1,-1,-0.4),"cm")) 
```


## GBM
```{r, echo=F}
west <- readRDS("/Users/philippinechambault/Documents/POST-DOC/2021/PAPER3/RDATA/5.CARET/Bw_West/Predictions/Summer/AWI-CM-1-1-MR/Average_6var/PredMean_Summer_6var_AWI-CM-1-1-MR_Bw_West_gbm.rds")
west <- as_tibble(rasterToPoints(west))

east <- readRDS("/Users/philippinechambault/Documents/POST-DOC/2021/PAPER3/RDATA/5.CARET/Bw_East/Predictions/Summer/AWI-CM-1-1-MR/Average_6var/PredMean_Summer_6var_AWI-CM-1-1-MR_Bw_East_gbm.rds")
east <- as_tibble(rasterToPoints(east))
```

```{r, echo=FALSE, fig.pos="placeHere", fig.height=4,fig.cap="\\label{fig:figs}Mean prediction maps for Bowheads in summer from the GBM."}
ggplot(shore, aes(long, lat)) +
  geom_tile(data=west, aes(x,y, fill=layer)) +
  geom_tile(data=east, aes(x,y, fill=layer)) +
  scale_fill_distiller(palette="BuPu", direction=1, 
                       limits=c(0,1), breaks=seq(0,1,by=0.2)) +
  coord_map("azequidistant", xlim=c(-105,80), ylim=c(60,80)) +
  scale_y_continuous(breaks=c(60,70), labels=c(60,70)) +
  geom_polygon(aes(group=group), fill="lightgrey",lwd=1) +
  labs(y="",x="",fill="Habitat \nsuitability",title="Bowheads",
       subtitle="Summer, GBM") + 
  theme(axis.text.y  = element_blank(),
        axis.text.x  = element_blank(),
        axis.ticks   = element_blank(),
        strip.background = element_rect(fill="gray52", size=0.1),
        strip.text = element_text(colour='black',size=12,face="bold",
                                  margin=margin(0.1,0.1,0.1,0.1,"cm")),
        axis.title = element_text(size=12,face="bold", hjust=0.5),
        panel.border = element_rect(colour="black",fill=NA,size=0.2),
        legend.key.size = unit(0.5,"line"),
        legend.key.width = unit(0.14,"cm"),
        legend.key.height = unit(0.3,"cm"),
        legend.title = element_text(size=7),
        legend.text = element_text(size=7),
        legend.box.spacing = unit(0.1,'cm'),
        legend.margin=margin(t=-0.0, unit='cm'),
        legend.key = element_blank(),
        panel.spacing.x = unit(0.07, "lines"),
        panel.spacing.y = unit(0.07, "lines"),
        title = element_text(colour="black",size=14,face="bold"),
        plot.title=element_text(size=14, vjust=-0.5, hjust=0),
        panel.background = element_blank(),
        panel.grid.major = element_line(colour="gray52", size=0.1),
        plot.margin = unit(c(0,0.1,-1,-0.4),"cm")) 
```

## Max GBM
```{r, echo=F}
west <- readRDS("/Users/philippinechambault/Documents/POST-DOC/2021/PAPER3/RDATA/5.CARET/Bw_West/Predictions/Summer/AWI-CM-1-1-MR/Average_6var/PredMax_Summer_6var_AWI-CM-1-1-MR_Bw_West_gbm.rds")
west <- as_tibble(rasterToPoints(west))

east <- readRDS("/Users/philippinechambault/Documents/POST-DOC/2021/PAPER3/RDATA/5.CARET/Bw_East/Predictions/Summer/AWI-CM-1-1-MR/Average_6var/PredMax_Summer_6var_AWI-CM-1-1-MR_Bw_East_gbm.rds")
east <- as_tibble(rasterToPoints(east))
```

```{r, echo=FALSE, fig.pos="placeHere", fig.height=4,fig.cap="\\label{fig:figs}Max prediction maps for Bowheads in summer (present) from the GBM."}
ggplot(shore, aes(long, lat)) +
  geom_tile(data=west, aes(x,y, fill=layer)) +
  geom_tile(data=east, aes(x,y, fill=layer)) +
  scale_fill_distiller(palette="BuPu", direction=1,
                     limits=c(0,1), breaks=seq(0,1,by=0.2)) +
  # geom_contour_filled(data=west, aes(x,y,z=layer), breaks=seq(0,1,by=0.2)) +
  # geom_contour_filled(data=east, aes(x,y,z=layer), breaks=seq(0,1,by=0.2)) +
  # scale_fill_brewer(palette="BuPu") + 
  coord_map("azequidistant", xlim=c(-105,80), ylim=c(60,80)) +
  scale_y_continuous(breaks=c(60,70), labels=c(60,70)) +
  geom_polygon(aes(group=group), fill="lightgrey",lwd=1) +
  labs(y="",x="",fill="Habitat \nsuitability",title="Bowheads",
       subtitle="Summer, Max GBM") + 
  theme(axis.text.y  = element_blank(),
        axis.text.x  = element_blank(),
        axis.ticks   = element_blank(),
        strip.background = element_rect(fill="gray52", size=0.1),
        strip.text = element_text(colour='black',size=12,face="bold",
                                  margin=margin(0.1,0.1,0.1,0.1,"cm")),
        axis.title = element_text(size=12,face="bold", hjust=0.5),
        panel.border = element_rect(colour="black",fill=NA,size=0.2),
        legend.key.size = unit(0.5,"line"),
        legend.key.width = unit(0.14,"cm"),
        legend.key.height = unit(0.3,"cm"),
        legend.title = element_text(size=7),
        legend.text = element_text(size=7),
        legend.box.spacing = unit(0.1,'cm'),
        legend.margin=margin(t=-0.0, unit='cm'),
        legend.key = element_blank(),
        panel.spacing.x = unit(0.07, "lines"),
        panel.spacing.y = unit(0.07, "lines"),
        title = element_text(colour="black",size=14,face="bold"),
        plot.title=element_text(size=14, vjust=-0.5, hjust=0),
        panel.background = element_blank(),
        panel.grid.major = element_line(colour="gray52", size=0.1),
        plot.margin = unit(c(0,0.1,-1,-0.4),"cm")) 
```


## GAM
```{r, echo=F}
west <- readRDS("/Users/philippinechambault/Documents/POST-DOC/2021/PAPER3/RDATA/5.CARET/Bw_West/Predictions/Summer/AWI-CM-1-1-MR/Average_6var/PredMean_Summer_6var_AWI-CM-1-1-MR_Bw_West_gamboost.rds")
west <- as_tibble(rasterToPoints(west))

east <- readRDS("/Users/philippinechambault/Documents/POST-DOC/2021/PAPER3/RDATA/5.CARET/Bw_East/Predictions/Summer/AWI-CM-1-1-MR/Average_6var/PredMean_Summer_6var_AWI-CM-1-1-MR_Bw_East_gamboost.rds")
east <- as_tibble(rasterToPoints(east))
```

```{r, echo=FALSE, fig.pos="placeHere", fig.height=4,fig.cap="\\label{fig:figs}Mean prediction maps for Bowheads in summer from the GAM."}
ggplot(shore, aes(long, lat)) +
  geom_tile(data=west, aes(x,y, fill=layer)) +
  geom_tile(data=east, aes(x,y, fill=layer)) +
  scale_fill_distiller(palette="BuPu", direction=1, 
                       limits=c(0,1), breaks=seq(0,1,by=0.2)) +
  coord_map("azequidistant", xlim=c(-105,80), ylim=c(60,80)) +
  scale_y_continuous(breaks=c(60,70), labels=c(60,70)) +
  geom_polygon(aes(group=group), fill="lightgrey",lwd=1) +
  labs(y="",x="",fill="Habitat \nsuitability",title="Bowheads",
       subtitle="Summer, GAM") + 
  theme(axis.text.y  = element_blank(),
        axis.text.x  = element_blank(),
        axis.ticks   = element_blank(),
        strip.background = element_rect(fill="gray52", size=0.1),
        strip.text = element_text(colour='black',size=12,face="bold",
                                  margin=margin(0.1,0.1,0.1,0.1,"cm")),
        axis.title = element_text(size=12,face="bold", hjust=0.5),
        panel.border = element_rect(colour="black",fill=NA,size=0.2),
        legend.key.size = unit(0.5,"line"),
        legend.key.width = unit(0.14,"cm"),
        legend.key.height = unit(0.3,"cm"),
        legend.title = element_text(size=7),
        legend.text = element_text(size=7),
        legend.box.spacing = unit(0.1,'cm'),
        legend.margin=margin(t=-0.0, unit='cm'),
        legend.key = element_blank(),
        panel.spacing.x = unit(0.07, "lines"),
        panel.spacing.y = unit(0.07, "lines"),
        title = element_text(colour="black",size=14,face="bold"),
        plot.title=element_text(size=14, vjust=-0.5, hjust=0),
        panel.background = element_blank(),
        panel.grid.major = element_line(colour="gray52", size=0.1),
        plot.margin = unit(c(0,0.1,-1,-0.4),"cm")) 
```


## GLM
```{r, echo=F}
west <- readRDS("/Users/philippinechambault/Documents/POST-DOC/2021/PAPER3/RDATA/5.CARET/Bw_West/Predictions/Summer/AWI-CM-1-1-MR/Average_6var/PredMean_Summer_6var_AWI-CM-1-1-MR_Bw_West_glmboost.rds")
west <- as_tibble(rasterToPoints(west))

east <- readRDS("/Users/philippinechambault/Documents/POST-DOC/2021/PAPER3/RDATA/5.CARET/Bw_East/Predictions/Summer/AWI-CM-1-1-MR/Average_6var/PredMean_Summer_6var_AWI-CM-1-1-MR_Bw_East_glmboost.rds")
east <- as_tibble(rasterToPoints(east))
```

```{r, echo=FALSE, fig.pos="placeHere", fig.height=4,fig.cap="\\label{fig:figs}Mean prediction maps for Bowheads in summer from the GLM."}
ggplot(shore, aes(long, lat)) +
  geom_tile(data=west, aes(x,y, fill=layer)) +
  geom_tile(data=east, aes(x,y, fill=layer)) +
  scale_fill_distiller(palette="BuPu", direction=1, 
                       limits=c(0,1), breaks=seq(0,1,by=0.2)) +
  coord_map("azequidistant", xlim=c(-105,80), ylim=c(60,80)) +
  scale_y_continuous(breaks=c(60,70), labels=c(60,70)) +
  geom_polygon(aes(group=group), fill="lightgrey",lwd=1) +
  labs(y="",x="",fill="Habitat \nsuitability",title="Bowheads",
       subtitle="Summer, GLM") + 
  theme(axis.text.y  = element_blank(),
        axis.text.x  = element_blank(),
        axis.ticks   = element_blank(),
        strip.background = element_rect(fill="gray52", size=0.1),
        strip.text = element_text(colour='black',size=12,face="bold",
                                  margin=margin(0.1,0.1,0.1,0.1,"cm")),
        axis.title = element_text(size=12,face="bold", hjust=0.5),
        panel.border = element_rect(colour="black",fill=NA,size=0.2),
        legend.key.size = unit(0.5,"line"),
        legend.key.width = unit(0.14,"cm"),
        legend.key.height = unit(0.3,"cm"),
        legend.title = element_text(size=7),
        legend.text = element_text(size=7),
        legend.box.spacing = unit(0.1,'cm'),
        legend.margin=margin(t=-0.0, unit='cm'),
        legend.key = element_blank(),
        panel.spacing.x = unit(0.07, "lines"),
        panel.spacing.y = unit(0.07, "lines"),
        title = element_text(colour="black",size=14,face="bold"),
        plot.title=element_text(size=14, vjust=-0.5, hjust=0),
        panel.background = element_blank(),
        panel.grid.major = element_line(colour="gray52", size=0.1),
        plot.margin = unit(c(0,0.1,-1,-0.4),"cm")) 
```


## RF
```{r, echo=F}
west <- readRDS("/Users/philippinechambault/Documents/POST-DOC/2021/PAPER3/RDATA/5.CARET/Bw_West/Predictions/Summer/AWI-CM-1-1-MR/Average_6var/PredMean_Summer_6var_AWI-CM-1-1-MR_Bw_West_rf.rds")
west <- as_tibble(rasterToPoints(west))

east <- readRDS("/Users/philippinechambault/Documents/POST-DOC/2021/PAPER3/RDATA/5.CARET/Bw_East/Predictions/Summer/AWI-CM-1-1-MR/Average_6var/PredMean_Summer_6var_AWI-CM-1-1-MR_Bw_East_rf.rds")
east <- as_tibble(rasterToPoints(east))
```

```{r, echo=FALSE, fig.pos="placeHere", fig.height=4,fig.cap="\\label{fig:figs}Mean prediction maps for Bowheads in summer from the RF."}
ggplot(shore, aes(long, lat)) +
  geom_tile(data=west, aes(x,y, fill=layer)) +
  geom_tile(data=east, aes(x,y, fill=layer)) +
  scale_fill_distiller(palette="BuPu", direction=1, 
                       limits=c(0,1), breaks=seq(0,1,by=0.2)) +
  coord_map("azequidistant", xlim=c(-105,80), ylim=c(60,80)) +
  scale_y_continuous(breaks=c(60,70), labels=c(60,70)) +
  geom_polygon(aes(group=group), fill="lightgrey",lwd=1) +
  labs(y="",x="",fill="Habitat \nsuitability",title="Bowheads",
       subtitle="Summer, RF") + 
  theme(axis.text.y  = element_blank(),
        axis.text.x  = element_blank(),
        axis.ticks   = element_blank(),
        strip.background = element_rect(fill="gray52", size=0.1),
        strip.text = element_text(colour='black',size=12,face="bold",
                                  margin=margin(0.1,0.1,0.1,0.1,"cm")),
        axis.title = element_text(size=12,face="bold", hjust=0.5),
        panel.border = element_rect(colour="black",fill=NA,size=0.2),
        legend.key.size = unit(0.5,"line"),
        legend.key.width = unit(0.14,"cm"),
        legend.key.height = unit(0.3,"cm"),
        legend.title = element_text(size=7),
        legend.text = element_text(size=7),
        legend.box.spacing = unit(0.1,'cm'),
        legend.margin=margin(t=-0.0, unit='cm'),
        legend.key = element_blank(),
        panel.spacing.x = unit(0.07, "lines"),
        panel.spacing.y = unit(0.07, "lines"),
        title = element_text(colour="black",size=14,face="bold"),
        plot.title=element_text(size=14, vjust=-0.5, hjust=0),
        panel.background = element_blank(),
        panel.grid.major = element_line(colour="gray52", size=0.1),
        plot.margin = unit(c(0,0.1,-1,-0.4),"cm")) 
```


